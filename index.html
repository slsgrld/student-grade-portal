<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Grade Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PapaParse (for CSV parsing) -->
    <script src="https://unpkg.com/papaparse@5.3.1/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        
        .sdg-gradient {
            background: linear-gradient(90deg, #E5243B 0%, #DDA63A 14%, #4C9F38 28%, #C5192D 42%, #FF3A21 56%, #26BDE2 70%, #FCC30B 84%, #A21942 100%);
            height: 5px;
        }
        
        .modal {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease forwards;
        }
        
        .grade-highlight {
            text-shadow: 0 0 15px rgba(76, 159, 56, 0.3);
        }
        
        .attendance-highlight {
            font-weight: 700;
            color: #4C9F38;
            text-shadow: 0 0 10px rgba(76, 159, 56, 0.2);
        }
        
        .absence-warning {
            font-weight: 700;
            color: #C5192D;
            text-shadow: 0 0 10px rgba(197, 25, 45, 0.2);
        }
        
        .attendance-warning {
            background-color: #FEF2F2;
            border-color: #FCA5A5;
        }
        
        .section-grades {
            border-top: 4px solid #4C9F38;
        }
        
        .section-attendance {
            border-top: 4px solid #26BDE2;
        }
        
        .section-midterm {
            border-top: 4px solid #DDA63A;
        }
        
        .section-final {
            border-top: 4px solid #FF3A21;
        }
        
        .section-remarks {
            border-top: 4px solid #A21942;
        }
        
        .info-icon {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .info-icon:hover {
            transform: scale(1.1);
        }
        
        .platform-info {
            background: linear-gradient(to right, rgba(38, 189, 226, 0.1), rgba(76, 159, 56, 0.1));
            border-left: 4px solid #26BDE2;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .footer-link {
            transition: all 0.2s ease;
            color: #4C9F38;
            text-decoration: underline;
        }
        
        .footer-link:hover {
            color: #3d8c29;
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="sdg-gradient w-full"></div>
    
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Student Grade Portal</h1>
            <p class="text-gray-600 mt-2">View your grades, attendance, and academic status</p>
        </header>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="mb-6" id="search-section">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">Enter Student Number</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input type="text" id="studentNumber" placeholder="e.g., C2024XXXXX" class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="submitBtn" class="px-6 py-2 bg-[#4C9F38] text-white font-medium rounded-md hover:bg-[#3d8c29] transition-colors" disabled>
                        Submit
                    </button>
                    <button id="resetBtn" class="px-6 py-2 bg-gray-200 text-gray-700 font-medium rounded-md hover:bg-gray-300 transition-colors">
                        Reset
                    </button>
                </div>
                <p id="error-message" class="mt-2 text-red-500 hidden"></p>
            </div>
            
            <div id="results" class="hidden">
                <!-- Results will be injected here -->
            </div>
        </div>
        
        <footer class="text-center text-gray-700 mt-12 pb-8 bg-gray-50 p-6 rounded-lg shadow-sm text-sm leading-relaxed">
            <h3 class="font-semibold text-base mb-2">Student Grade Portal</h3>
            <p>Developed by Dr. Gerald M. Salas</p>
            <p class="mt-2">This platform is used only for viewing grades and academic status.</p>
            <p class="mt-2">For inquiries, email: 
                <a href="mailto:gerald_salas@psau.edu.ph" class="footer-link font-medium">gerald_salas@psau.edu.ph</a>
            </p>
            <p class="mt-1 text-xs text-gray-500">© 2025 Pampanga State Agricultural University</p>
        </footer>
    </div>
    
    <!-- Attendance Policy Modal -->
    <div id="attendance-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Attendance Policy</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="prose">
                <p class="text-gray-700"><strong>Excerpt from the BOR-approved Student Manual. Also relayed in our class group chat.</strong></p>
                <p class="text-gray-700 mt-3">3.8.1.7. When the students' absences in a subject in one semester have reached 20% of the required number of hours of recitation, lecture, laboratory, or any scheduled work, and the absences are unexcused, the student shall be unofficially dropped from the class and given a grade of 5.0.</p>
                <p class="text-gray-700 mt-3">For this class:</p>
                <ul class="text-gray-700 list-disc pl-5">
                    <li>Each session is 1 hour and 30 minutes</li>
                    <li>Total of 16 sessions = 24 hours</li>
                    <li>20% threshold = 4.8 hours (more than 3 absences)</li>
                </ul>
                <div class="mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded">
                    <p class="text-sm text-yellow-800 font-medium">
                        ⚠️ Note: For the purpose of academic leniency, students were considered unofficially dropped only if their absences reached at least <strong>50% of the total sessions</strong>, instead of the 20% threshold stated in the official policy.
                    </p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Important Notes Modal -->
    <div id="notes-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Important Notes</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div id="notes-content" class="prose">
                <!-- Dynamically inserted if needed -->
            </div>
        </div>
    </div>
    
    <!-- Grade Calculation Modal -->
    <div id="grade-calculation-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">Grade Calculation</h3>
                <button class="close-modal text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="prose">
                <p class="text-gray-700"><strong>Final Grade Calculation Formula</strong></p>
                <p class="text-gray-700 mt-3">The final grade is calculated as follows:</p>
                <div class="bg-gray-50 p-4 rounded-lg my-3">
                    <p class="font-medium text-center">Final Grade = 50% of Midterm Grade + 50% of Final Term Grade</p>
                </div>
                <p class="text-gray-700 mt-3"><strong>Component Weights:</strong></p>
                <ul class="text-gray-700 list-disc pl-5">
                    <li>Studentship: 10%</li>
                    <li>Activities: 30%</li>
                    <li>Recitation: 10%</li>
                    <li>Quizzes: 20%</li>
                    <li>Major Examination: 30%</li>
                </ul>
                <p class="text-gray-700 mt-3">These weights apply to both midterm and final term grades.</p>
            </div>
        </div>
    </div>
    
    <script>
        // We'll fill this array once the CSV has been fetched:
        let students = [];

        // Grab references to DOM elements:
        const submitBtn = document.getElementById('submitBtn');
        const resetBtn = document.getElementById('resetBtn');
        const studentNumberInput = document.getElementById('studentNumber');
        const errorMessage = document.getElementById('error-message');
        const resultsDiv = document.getElementById('results');
        const attendanceModal = document.getElementById('attendance-modal');
        const notesModal = document.getElementById('notes-modal');
        const notesContent = document.getElementById('notes-content');
        const gradeCalculationModal = document.getElementById('grade-calculation-modal');

        // Disable the Submit button until CSV is loaded:
        submitBtn.disabled = true;

        // 1) Load and parse the CSV from GitHub using PapaParse:
        Papa.parse("https://raw.githubusercontent.com/slsgrld/student-grade-portal/main/students_grades.csv", {
            download: true,
            header: true,
            skipEmptyLines: true,
            dynamicTyping: true,
            complete: function(results) {
                // Map each row into our "students" array with proper nesting:
                students = results.data.map(row => ({
                    studentNumber: row.studentNumber.trim(),
                    name: row.name.trim(),
                    attendance: isNaN(row.attendance) ? row.attendance : Number(row.attendance),
                    midterm: {
                        studentship: row.midtermStudentship,
                        activities: row.midtermActivities,
                        recitation: row.midtermRecitation,
                        quizzes: row.midtermQuizzes,
                        exam: row.midtermExam,
                        average: row.midtermAverage,
                        grade: row.midtermGrade
                    },
                    final: {
                        studentship: row.finalStudentship,
                        activities: row.finalActivities,
                        recitation: row.finalRecitation,
                        quizzes: row.finalQuizzes,
                        exam: row.finalExam,
                        average: row.finalAverage,
                        grade: row.finalGrade
                    },
                    finalGradeAverage: row.finalGradeAverage,
                    finalGradeEquivalent: row.finalGradeEquivalent,
                    interpretation: row.interpretation,
                    remarks: row.remarks
                }));
                // Now that we have data, enable the search button:
                submitBtn.disabled = false;
            },
            error: function(err) {
                console.error("Error loading CSV:", err);
                errorMessage.textContent = "Failed to load student data.";
                errorMessage.classList.remove("hidden");
            }
        });

        // 2) Wire up event listeners:
        submitBtn.addEventListener('click', searchStudent);
        resetBtn.addEventListener('click', resetForm);
        studentNumberInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchStudent();
            }
        });

        // Close modals when clicking the [×] button:
        document.querySelectorAll('.close-modal').forEach(button => {
            button.addEventListener('click', () => {
                attendanceModal.classList.add('hidden');
                notesModal.classList.add('hidden');
                gradeCalculationModal.classList.add('hidden');
            });
        });

        // Close modals when clicking outside them:
        window.addEventListener('click', (e) => {
            if (e.target === attendanceModal) {
                attendanceModal.classList.add('hidden');
            }
            if (e.target === notesModal) {
                notesModal.classList.add('hidden');
            }
            if (e.target === gradeCalculationModal) {
                gradeCalculationModal.classList.add('hidden');
            }
        });

        function searchStudent() {
            const studentNumber = studentNumberInput.value.trim();
            if (!studentNumber) {
                showError("Please enter a Student Number");
                return;
            }
            // Find the student in our array:
            const student = students.find(s => s.studentNumber === studentNumber);
            if (!student) {
                showError("Student not found. Please check your Student Number.");
                return;
            }
            displayStudentData(student);
        }

        function resetForm() {
            studentNumberInput.value = '';
            errorMessage.classList.add('hidden');
            resultsDiv.classList.add('hidden');
            resultsDiv.innerHTML = '';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
        }

        function displayStudentData(student) {
            errorMessage.classList.add('hidden');

            // Determine status colors based on interpretation:
            let statusColor = '', statusBorder = '';
            if (student.interpretation === "Passed") {
                statusColor = 'text-green-700';
                statusBorder = 'border-green-300';
            } else if (student.interpretation === "Incomplete") {
                statusColor = 'text-orange-700';
                statusBorder = 'border-orange-300';
            } else if (student.interpretation === "Unofficially Dropped") {
                statusColor = 'text-red-700';
                statusBorder = 'border-red-300';
            }

            // Attendance calculations:
            const totalHours = 16 * 1.5; // 16 sessions × 1.5 hours each
            const attendedHours = (isNaN(student.attendance) ? 0 : student.attendance) * 1.5;
            const absentHours = totalHours - attendedHours;
            const attendancePercentage = isNaN(student.attendance) ? 0 : (student.attendance / 16) * 100;
            const absencePercentage = 100 - attendancePercentage;
            const isAbsenceExcessive = absentHours >= (totalHours * 0.2);

            // Build the HTML for results:
            resultsDiv.innerHTML = `
                <div class="fade-in">
                    <!-- Final Assessment Section -->
                    <div class="mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-md section-grades">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">${student.name}</h2>
                            <div class="flex items-center">
                                <span class="text-sm text-gray-500 mr-2">Grade Calculation</span>
                                <div id="grade-info" class="info-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-500" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                    </svg>
                                </div>
                            </div>
                        </div>

                        <!-- Emphasized Final Grade Section -->
                        <div class="flex flex-col md:flex-row items-center justify-center gap-4 mb-8 p-4 bg-gray-50 rounded-lg border ${statusBorder}">
                            <div class="flex-1 text-center">
                                <div class="text-sm uppercase tracking-wide text-gray-500 mb-1">Final Grade Average</div>
                                <div class="text-5xl font-bold grade-highlight ${student.interpretation === "Passed" ? 'text-[#4C9F38]' : student.interpretation === "Incomplete" ? 'text-[#DDA63A]' : 'text-[#C5192D]'}">
                                    ${student.finalGradeAverage === "N/A" ? "N/A" : Number(student.finalGradeAverage).toFixed(2)}
                                </div>
                            </div>

                            <div class="flex-1 text-center">
                                <div class="text-sm uppercase tracking-wide text-gray-500 mb-1">Final Grade Equivalent</div>
                                <div class="text-5xl font-bold grade-highlight ${student.interpretation === "Passed" ? 'text-[#4C9F38]' : student.interpretation === "Incomplete" ? 'text-[#DDA63A]' : 'text-[#C5192D]'}">
                                    ${student.finalGradeEquivalent}
                                </div>
                            </div>

                            <div class="flex-1 text-center">
                                <div class="text-sm uppercase tracking-wide text-gray-500 mb-1">Status</div>
                                <div class="text-2xl font-bold ${statusColor}">
                                    ${student.interpretation}
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <div class="p-4 bg-[#FFF8E1] rounded-lg text-center border border-[#FFE082]">
                                <div class="text-sm text-gray-600">Midterm Grade</div>
                                <div class="text-xl font-semibold text-[#F57F17]">${student.midterm.grade}</div>
                                <div class="text-sm text-gray-600">Average: ${student.midterm.average === "N/A" ? "N/A" : Number(student.midterm.average).toFixed(2)}</div>
                            </div>

                            <div class="p-4 bg-[#E8F5E9] rounded-lg text-center border border-[#A5D6A7]">
                                <div class="text-sm text-gray-600">Final Term Grade</div>
                                <div class="text-xl font-semibold text-[#2E7D32]">${student.final.grade}</div>
                                <div class="text-sm text-gray-600">Average: ${student.final.average === "N/A" ? "N/A" : Number(student.final.average).toFixed(2)}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Remarks Section (if any) -->
                    ${student.remarks || (student.interpretation !== "Passed") ? `
                    <div class="mb-8 p-6 bg-amber-50 rounded-lg border-l-4 border-amber-500 shadow-lg section-remarks">
                        <div class="flex items-start">
                            <div class="mr-4 text-amber-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                </svg>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold text-amber-800 mb-2">Important Notes</h3>
                                ${student.remarks ? `<p class="text-amber-900 font-medium text-lg mb-3">${student.remarks}</p>` : ''}
                                ${student.interpretation === "Incomplete" ? `
                                    <p class="text-amber-800">You have one year to complete the missing requirements. If not completed, the grade will lapse to 5.0.</p>
                                ` : student.interpretation === "Unofficially Dropped" ? `
                                    <p class="text-amber-800">Your academic status is based on the Attendance Policy outlined in the BOR-approved Student Manual.</p>
                                    <p class="text-amber-800 mt-2">When absences reach 20% of the required number of hours (${Math.round(totalHours * 0.2)} hours or more than ${Math.floor((totalHours * 0.2) / 1.5)} sessions), the student shall be unofficially dropped from the class and given a grade of 5.0.</p>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Attendance Record -->
                    <div class="mb-8 p-6 bg-white rounded-lg border border-gray-200 shadow-md ${isAbsenceExcessive ? 'attendance-warning' : ''} section-attendance">
                        <h3 class="text-xl font-semibold mb-4 text-gray-800">Attendance Record</h3>
                        ${isAbsenceExcessive ? `
                        <div class="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                                </svg>
                                <span class="text-red-700 font-medium">Warning: Absences have reached or exceeded 20% of total class hours</span>
                            </div>
                        </div>
                        ` : ''}
                        <div class="flex flex-col md:flex-row items-center justify-center gap-8">
                            <div class="relative w-36 h-36">
                                <svg class="w-full h-full" viewBox="0 0 100 100">
                                    <!-- Background circle -->
                                    <circle cx="50" cy="50" r="45" fill="#f3f4f6" />
                                    <!-- Attendance pie chart -->
                                    <circle cx="50" cy="50" r="45" fill="transparent" stroke="#E5E7EB" stroke-width="10" />
                                    <!-- Present portion -->
                                    <path d="${describeArc(50, 50, 45, 0, attendancePercentage * 3.6)}"
                                          fill="none"
                                          stroke="${attendancePercentage >= 80 ? '#4C9F38' : attendancePercentage >= 60 ? '#DDA63A' : '#C5192D'}"
                                          stroke-width="10" />
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center flex-col">
                                    <span class="text-3xl font-bold">${Math.round(attendancePercentage)}%</span>
                                    <span class="text-sm text-gray-500">attended</span>
                                </div>
                            </div>
                            <div class="text-center md:text-left">
                                <p class="text-gray-700 mb-2">
                                    <span class="attendance-highlight">${student.attendance}</span> present out of 16 sessions
                                    (<span class="absence-warning">${16 - student.attendance}</span> absences)
                                </p>
                                <p class="text-gray-700 mb-4">
                                    Total hours: ${attendedHours} of ${totalHours} hours
                                    ${isAbsenceExcessive ? 
                                        `<span class="block mt-1 text-red-600 font-semibold">
                                            Absences: ${absentHours} hours (${Math.round(absencePercentage)}% of total hours)
                                        </span>` : ''}
                                </p>
                                <button id="view-policy-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
                                    View Attendance Policy
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Grade Details -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                        <!-- Midterm Grade Details -->
                        <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-md section-midterm">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Midterm Grade Details</h3>
                            <table class="w-full">
                                <tbody>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Studentship (10%)</td>
                                        <td class="py-2 font-medium text-right">${student.midterm.studentship}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Activities (30%)</td>
                                        <td class="py-2 font-medium text-right">${student.midterm.activities}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Recitation (10%)</td>
                                        <td class="py-2 font-medium text-right">${student.midterm.recitation}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Quizzes (20%)</td>
                                        <td class="py-2 font-medium text-right">${student.midterm.quizzes}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Major Examination (30%)</td>
                                        <td class="py-2 font-medium text-right">${student.midterm.exam}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600 font-semibold">Midterm Average</td>
                                        <td class="py-2 font-semibold text-right">${student.midterm.average}</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 text-gray-600 font-semibold">Midterm Grade</td>
                                        <td class="py-2 font-semibold text-right">${student.midterm.grade}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Final Term Grade Details -->
                        <div class="p-6 bg-white rounded-lg border border-gray-200 shadow-md section-final">
                            <h3 class="text-xl font-semibold mb-4 text-gray-800">Final Term Grade Details</h3>
                            <table class="w-full">
                                <tbody>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Studentship (10%)</td>
                                        <td class="py-2 font-medium text-right">${student.final.studentship}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Activities (30%)</td>
                                        <td class="py-2 font-medium text-right">${student.final.activities}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Recitation (10%)</td>
                                        <td class="py-2 font-medium text-right">${student.final.recitation}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Quizzes (20%)</td>
                                        <td class="py-2 font-medium text-right">${student.final.quizzes}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600">Major Examination (30%)</td>
                                        <td class="py-2 font-medium text-right">${student.final.exam}</td>
                                    </tr>
                                    <tr class="border-b">
                                        <td class="py-2 text-gray-600 font-semibold">Final Average</td>
                                        <td class="py-2 font-semibold text-right">${student.final.average}</td>
                                    </tr>
                                    <tr>
                                        <td class="py-2 text-gray-600 font-semibold">Final Grade</td>
                                        <td class="py-2 font-semibold text-right">${student.final.grade}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Academic Information -->
                    <div class="p-6 platform-info rounded-lg mb-8">
                        <div class="flex items-start">
                            <div class="mr-3 text-blue-500 mt-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <p class="text-gray-800 font-medium">
                                For transparency, the detailed scores of your activities, assignments, and other class submissions are available on our official learning platform, <span class="text-blue-700 font-semibold">Gnomio</span>. Please log in to view your full performance record.
                            </p>
                        </div>
                    </div>
                </div>
            `;
            resultsDiv.classList.remove('hidden');

            // Wire up modal buttons again:
            document.getElementById('view-policy-btn').addEventListener('click', () => {
                attendanceModal.classList.remove('hidden');
            });
            document.getElementById('grade-info').addEventListener('click', () => {
                gradeCalculationModal.classList.remove('hidden');
            });
        }

        // Helper functions for the SVG pie chart:
        function polarToCartesian(centerX, centerY, radius, angleInDegrees) {
            const angleInRadians = (angleInDegrees - 90) * Math.PI / 180.0;
            return {
                x: centerX + (radius * Math.cos(angleInRadians)),
                y: centerY + (radius * Math.sin(angleInRadians))
            };
        }

        function describeArc(x, y, radius, startAngle, endAngle) {
            const start = polarToCartesian(x, y, radius, endAngle);
            const end = polarToCartesian(x, y, radius, startAngle);
            const largeArcFlag = endAngle - startAngle <= 180 ? "0" : "1";
            return [
                "M", start.x, start.y,
                "A", radius, radius, 0, largeArcFlag, 0, end.x, end.y
            ].join(" ");
        }
    </script>
</body>
</html>
